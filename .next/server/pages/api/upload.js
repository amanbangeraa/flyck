"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/upload";
exports.ids = ["pages/api/upload"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "busboy":
/*!*************************!*\
  !*** external "busboy" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("busboy");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fupload.ts&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fupload.ts&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_upload_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/upload.ts */ \"(api)/./pages/api/upload.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_upload_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_upload_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/upload\",\n        pathname: \"/api/upload\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_upload_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnVwbG9hZCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGdXBsb2FkLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ2tEO0FBQ2xEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxpREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsaURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmx5Y2svP2YxYjkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS91cGxvYWQudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS91cGxvYWRcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS91cGxvYWRcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fupload.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/blob.ts":
/*!*********************!*\
  !*** ./lib/blob.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   uploadImage: () => (/* binding */ uploadImage)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(api)/./lib/supabase.ts\");\n\nasync function uploadImage(file) {\n    // Upload to Supabase Storage bucket 'slides'\n    const filePath = `${Date.now()}-${file.name}`;\n    const { data, error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.storage.from(\"slides\").upload(filePath, file, {\n        cacheControl: \"3600\",\n        upsert: false,\n        contentType: file.type\n    });\n    if (error) throw error;\n    // Get public URL\n    const { data: publicUrlData } = _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.storage.from(\"slides\").getPublicUrl(filePath);\n    return publicUrlData.publicUrl;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvYmxvYi50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFzQztBQUUvQixlQUFlQyxZQUFZQyxJQUFVO0lBQzFDLDZDQUE2QztJQUM3QyxNQUFNQyxXQUFXLENBQUMsRUFBRUMsS0FBS0MsR0FBRyxHQUFHLENBQUMsRUFBRUgsS0FBS0ksSUFBSSxDQUFDLENBQUM7SUFDN0MsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1SLCtDQUFRQSxDQUFDUyxPQUFPLENBQUNDLElBQUksQ0FBQyxVQUFVQyxNQUFNLENBQUNSLFVBQVVELE1BQU07UUFDbkZVLGNBQWM7UUFDZEMsUUFBUTtRQUNSQyxhQUFhWixLQUFLYSxJQUFJO0lBQ3hCO0lBQ0EsSUFBSVAsT0FBTyxNQUFNQTtJQUNqQixpQkFBaUI7SUFDakIsTUFBTSxFQUFFRCxNQUFNUyxhQUFhLEVBQUUsR0FBR2hCLCtDQUFRQSxDQUFDUyxPQUFPLENBQUNDLElBQUksQ0FBQyxVQUFVTyxZQUFZLENBQUNkO0lBQzdFLE9BQU9hLGNBQWNFLFNBQVM7QUFDaEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mbHljay8uL2xpYi9ibG9iLnRzP2E5NmUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuL3N1cGFiYXNlJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwbG9hZEltYWdlKGZpbGU6IEZpbGUpIHtcbiAgLy8gVXBsb2FkIHRvIFN1cGFiYXNlIFN0b3JhZ2UgYnVja2V0ICdzbGlkZXMnXG4gIGNvbnN0IGZpbGVQYXRoID0gYCR7RGF0ZS5ub3coKX0tJHtmaWxlLm5hbWV9YDtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Uuc3RvcmFnZS5mcm9tKCdzbGlkZXMnKS51cGxvYWQoZmlsZVBhdGgsIGZpbGUsIHtcbiAgICBjYWNoZUNvbnRyb2w6ICczNjAwJyxcbiAgICB1cHNlcnQ6IGZhbHNlLFxuICAgIGNvbnRlbnRUeXBlOiBmaWxlLnR5cGUsXG4gIH0pO1xuICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAvLyBHZXQgcHVibGljIFVSTFxuICBjb25zdCB7IGRhdGE6IHB1YmxpY1VybERhdGEgfSA9IHN1cGFiYXNlLnN0b3JhZ2UuZnJvbSgnc2xpZGVzJykuZ2V0UHVibGljVXJsKGZpbGVQYXRoKTtcbiAgcmV0dXJuIHB1YmxpY1VybERhdGEucHVibGljVXJsO1xufVxuIl0sIm5hbWVzIjpbInN1cGFiYXNlIiwidXBsb2FkSW1hZ2UiLCJmaWxlIiwiZmlsZVBhdGgiLCJEYXRlIiwibm93IiwibmFtZSIsImRhdGEiLCJlcnJvciIsInN0b3JhZ2UiLCJmcm9tIiwidXBsb2FkIiwiY2FjaGVDb250cm9sIiwidXBzZXJ0IiwiY29udGVudFR5cGUiLCJ0eXBlIiwicHVibGljVXJsRGF0YSIsImdldFB1YmxpY1VybCIsInB1YmxpY1VybCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/blob.ts\n");

/***/ }),

/***/ "(api)/./lib/kv.ts":
/*!*******************!*\
  !*** ./lib/kv.ts ***!
  \*******************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getHeartbeats: () => (/* binding */ getHeartbeats),\n/* harmony export */   getSlides: () => (/* binding */ getSlides),\n/* harmony export */   setHeartbeat: () => (/* binding */ setHeartbeat),\n/* harmony export */   setSlides: () => (/* binding */ setSlides)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(api)/./lib/supabase.ts\");\n\nasync function getSlides(displayId) {\n    const { data, error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"slides\").select(\"url, uploaded_at, duration\").eq(\"display_id\", displayId).order(\"uploaded_at\", {\n        ascending: true\n    });\n    if (error) throw error;\n    // Map to camelCase for frontend compatibility\n    return (data || []).map((s)=>({\n            url: s.url,\n            uploadedAt: s.uploaded_at,\n            duration: s.duration ?? 10000\n        }));\n}\nasync function setSlides(displayId, slides) {\n    // Remove old slides for this display\n    await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"slides\").delete().eq(\"display_id\", displayId);\n    // Insert new slides\n    if (slides.length > 0) {\n        const insertData = slides.map((s)=>({\n                display_id: displayId,\n                url: s.url,\n                uploaded_at: s.uploaded_at,\n                duration: s.duration ?? 10000\n            }));\n        await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"slides\").insert(insertData);\n    }\n}\nasync function setHeartbeat(id, at) {\n    await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"heartbeats\").upsert({\n        id,\n        last_seen: at\n    });\n}\nasync function getHeartbeats() {\n    const { data, error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"heartbeats\").select(\"id, last_seen\");\n    if (error) throw error;\n    const now = Date.now();\n    return (data || []).map((hb)=>({\n            id: hb.id,\n            online: hb.last_seen && now - Number(hb.last_seen) < 10 * 60 * 1000,\n            lastSeen: hb.last_seen\n        }));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIva3YudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBc0M7QUFFL0IsZUFBZUMsVUFBVUMsU0FBaUI7SUFDL0MsTUFBTSxFQUFFQyxJQUFJLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1KLCtDQUFRQSxDQUNuQ0ssSUFBSSxDQUFDLFVBQ0xDLE1BQU0sQ0FBQyw4QkFDUEMsRUFBRSxDQUFDLGNBQWNMLFdBQ2pCTSxLQUFLLENBQUMsZUFBZTtRQUFFQyxXQUFXO0lBQUs7SUFDMUMsSUFBSUwsT0FBTyxNQUFNQTtJQUNqQiw4Q0FBOEM7SUFDOUMsT0FBTyxDQUFDRCxRQUFRLEVBQUUsRUFBRU8sR0FBRyxDQUFDQyxDQUFBQSxJQUFNO1lBQUVDLEtBQUtELEVBQUVDLEdBQUc7WUFBRUMsWUFBWUYsRUFBRUcsV0FBVztZQUFFQyxVQUFVSixFQUFFSSxRQUFRLElBQUk7UUFBTTtBQUN2RztBQUVPLGVBQWVDLFVBQVVkLFNBQWlCLEVBQUVlLE1BQWlFO0lBQ2xILHFDQUFxQztJQUNyQyxNQUFNakIsK0NBQVFBLENBQUNLLElBQUksQ0FBQyxVQUFVYSxNQUFNLEdBQUdYLEVBQUUsQ0FBQyxjQUFjTDtJQUN4RCxvQkFBb0I7SUFDcEIsSUFBSWUsT0FBT0UsTUFBTSxHQUFHLEdBQUc7UUFDckIsTUFBTUMsYUFBYUgsT0FBT1AsR0FBRyxDQUFDQyxDQUFBQSxJQUFNO2dCQUNsQ1UsWUFBWW5CO2dCQUNaVSxLQUFLRCxFQUFFQyxHQUFHO2dCQUNWRSxhQUFhSCxFQUFFRyxXQUFXO2dCQUMxQkMsVUFBVUosRUFBRUksUUFBUSxJQUFJO1lBQzFCO1FBQ0EsTUFBTWYsK0NBQVFBLENBQUNLLElBQUksQ0FBQyxVQUFVaUIsTUFBTSxDQUFDRjtJQUN2QztBQUNGO0FBRU8sZUFBZUcsYUFBYUMsRUFBVSxFQUFFQyxFQUFVO0lBQ3ZELE1BQU16QiwrQ0FBUUEsQ0FBQ0ssSUFBSSxDQUFDLGNBQWNxQixNQUFNLENBQUM7UUFBRUY7UUFBSUcsV0FBV0Y7SUFBRztBQUMvRDtBQUVPLGVBQWVHO0lBQ3BCLE1BQU0sRUFBRXpCLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUosK0NBQVFBLENBQUNLLElBQUksQ0FBQyxjQUFjQyxNQUFNLENBQUM7SUFDakUsSUFBSUYsT0FBTyxNQUFNQTtJQUNqQixNQUFNeUIsTUFBTUMsS0FBS0QsR0FBRztJQUNwQixPQUFPLENBQUMxQixRQUFRLEVBQUUsRUFBRU8sR0FBRyxDQUFDcUIsQ0FBQUEsS0FBTztZQUM3QlAsSUFBSU8sR0FBR1AsRUFBRTtZQUNUUSxRQUFRRCxHQUFHSixTQUFTLElBQUlFLE1BQU1JLE9BQU9GLEdBQUdKLFNBQVMsSUFBSSxLQUFLLEtBQUs7WUFDL0RPLFVBQVVILEdBQUdKLFNBQVM7UUFDeEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2ZseWNrLy4vbGliL2t2LnRzP2VhNGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuL3N1cGFiYXNlJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNsaWRlcyhkaXNwbGF5SWQ6IHN0cmluZykge1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdzbGlkZXMnKVxuICAgIC5zZWxlY3QoJ3VybCwgdXBsb2FkZWRfYXQsIGR1cmF0aW9uJylcbiAgICAuZXEoJ2Rpc3BsYXlfaWQnLCBkaXNwbGF5SWQpXG4gICAgLm9yZGVyKCd1cGxvYWRlZF9hdCcsIHsgYXNjZW5kaW5nOiB0cnVlIH0pO1xuICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICAvLyBNYXAgdG8gY2FtZWxDYXNlIGZvciBmcm9udGVuZCBjb21wYXRpYmlsaXR5XG4gIHJldHVybiAoZGF0YSB8fCBbXSkubWFwKHMgPT4gKHsgdXJsOiBzLnVybCwgdXBsb2FkZWRBdDogcy51cGxvYWRlZF9hdCwgZHVyYXRpb246IHMuZHVyYXRpb24gPz8gMTAwMDAgfSkpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0U2xpZGVzKGRpc3BsYXlJZDogc3RyaW5nLCBzbGlkZXM6IHsgdXJsOiBzdHJpbmc7IHVwbG9hZGVkX2F0OiBzdHJpbmc7IGR1cmF0aW9uPzogbnVtYmVyIH1bXSkge1xuICAvLyBSZW1vdmUgb2xkIHNsaWRlcyBmb3IgdGhpcyBkaXNwbGF5XG4gIGF3YWl0IHN1cGFiYXNlLmZyb20oJ3NsaWRlcycpLmRlbGV0ZSgpLmVxKCdkaXNwbGF5X2lkJywgZGlzcGxheUlkKTtcbiAgLy8gSW5zZXJ0IG5ldyBzbGlkZXNcbiAgaWYgKHNsaWRlcy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3QgaW5zZXJ0RGF0YSA9IHNsaWRlcy5tYXAocyA9PiAoe1xuICAgICAgZGlzcGxheV9pZDogZGlzcGxheUlkLFxuICAgICAgdXJsOiBzLnVybCxcbiAgICAgIHVwbG9hZGVkX2F0OiBzLnVwbG9hZGVkX2F0LFxuICAgICAgZHVyYXRpb246IHMuZHVyYXRpb24gPz8gMTAwMDAsXG4gICAgfSkpO1xuICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ3NsaWRlcycpLmluc2VydChpbnNlcnREYXRhKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0SGVhcnRiZWF0KGlkOiBzdHJpbmcsIGF0OiBudW1iZXIpIHtcbiAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnaGVhcnRiZWF0cycpLnVwc2VydCh7IGlkLCBsYXN0X3NlZW46IGF0IH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SGVhcnRiZWF0cygpIHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgnaGVhcnRiZWF0cycpLnNlbGVjdCgnaWQsIGxhc3Rfc2VlbicpO1xuICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICByZXR1cm4gKGRhdGEgfHwgW10pLm1hcChoYiA9PiAoe1xuICAgIGlkOiBoYi5pZCxcbiAgICBvbmxpbmU6IGhiLmxhc3Rfc2VlbiAmJiBub3cgLSBOdW1iZXIoaGIubGFzdF9zZWVuKSA8IDEwICogNjAgKiAxMDAwLFxuICAgIGxhc3RTZWVuOiBoYi5sYXN0X3NlZW4sXG4gIH0pKTtcbn1cbiJdLCJuYW1lcyI6WyJzdXBhYmFzZSIsImdldFNsaWRlcyIsImRpc3BsYXlJZCIsImRhdGEiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwibWFwIiwicyIsInVybCIsInVwbG9hZGVkQXQiLCJ1cGxvYWRlZF9hdCIsImR1cmF0aW9uIiwic2V0U2xpZGVzIiwic2xpZGVzIiwiZGVsZXRlIiwibGVuZ3RoIiwiaW5zZXJ0RGF0YSIsImRpc3BsYXlfaWQiLCJpbnNlcnQiLCJzZXRIZWFydGJlYXQiLCJpZCIsImF0IiwidXBzZXJ0IiwibGFzdF9zZWVuIiwiZ2V0SGVhcnRiZWF0cyIsIm5vdyIsIkRhdGUiLCJoYiIsIm9ubGluZSIsIk51bWJlciIsImxhc3RTZWVuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/kv.ts\n");

/***/ }),

/***/ "(api)/./lib/sse.ts":
/*!********************!*\
  !*** ./lib/sse.ts ***!
  \********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   broadcast: () => (/* binding */ broadcast),\n/* harmony export */   openChannel: () => (/* binding */ openChannel)\n/* harmony export */ });\nconst channels = {};\nfunction openChannel(disp, res) {\n    res.writeHead(200, {\n        \"Content-Type\": \"text/event-stream\",\n        \"Cache-Control\": \"no-cache\",\n        Connection: \"keep-alive\",\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"X-Accel-Buffering\": \"no\",\n        retry: 10000\n    });\n    if (!channels[disp]) channels[disp] = new Set();\n    channels[disp].add(res);\n    res.on(\"close\", ()=>{\n        channels[disp].delete(res);\n    });\n}\nfunction broadcast(disp) {\n    if (!channels[disp]) return;\n    for (const res of channels[disp]){\n        res.write(\"event: update\\ndata: 1\\n\\n\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvc3NlLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsTUFBTUEsV0FBNkQsQ0FBQztBQUU3RCxTQUFTQyxZQUFZQyxJQUFZLEVBQUVDLEdBQVE7SUFDaERBLElBQUlDLFNBQVMsQ0FBQyxLQUFLO1FBQ2pCLGdCQUFnQjtRQUNoQixpQkFBaUI7UUFDakJDLFlBQVk7UUFDWiwrQkFBK0I7UUFDL0IscUJBQXFCO1FBQ3JCQyxPQUFPO0lBQ1Q7SUFDQSxJQUFJLENBQUNOLFFBQVEsQ0FBQ0UsS0FBSyxFQUFFRixRQUFRLENBQUNFLEtBQUssR0FBRyxJQUFJSztJQUMxQ1AsUUFBUSxDQUFDRSxLQUFLLENBQUNNLEdBQUcsQ0FBQ0w7SUFDbkJBLElBQUlNLEVBQUUsQ0FBQyxTQUFTO1FBQ2RULFFBQVEsQ0FBQ0UsS0FBSyxDQUFDUSxNQUFNLENBQUNQO0lBQ3hCO0FBQ0Y7QUFFTyxTQUFTUSxVQUFVVCxJQUFZO0lBQ3BDLElBQUksQ0FBQ0YsUUFBUSxDQUFDRSxLQUFLLEVBQUU7SUFDckIsS0FBSyxNQUFNQyxPQUFPSCxRQUFRLENBQUNFLEtBQUssQ0FBRTtRQUNoQ0MsSUFBSVMsS0FBSyxDQUFDO0lBQ1o7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2ZseWNrLy4vbGliL3NzZS50cz9mNTE5Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNoYW5uZWxzOiBSZWNvcmQ8c3RyaW5nLCBTZXQ8V3JpdGFibGVTdHJlYW1EZWZhdWx0V3JpdGVyPj4gPSB7fTtcblxuZXhwb3J0IGZ1bmN0aW9uIG9wZW5DaGFubmVsKGRpc3A6IHN0cmluZywgcmVzOiBhbnkpIHtcbiAgcmVzLndyaXRlSGVhZCgyMDAsIHtcbiAgICAnQ29udGVudC1UeXBlJzogJ3RleHQvZXZlbnQtc3RyZWFtJyxcbiAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZScsXG4gICAgQ29ubmVjdGlvbjogJ2tlZXAtYWxpdmUnLFxuICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKicsXG4gICAgJ1gtQWNjZWwtQnVmZmVyaW5nJzogJ25vJyxcbiAgICByZXRyeTogMTAwMDAsXG4gIH0pO1xuICBpZiAoIWNoYW5uZWxzW2Rpc3BdKSBjaGFubmVsc1tkaXNwXSA9IG5ldyBTZXQoKTtcbiAgY2hhbm5lbHNbZGlzcF0uYWRkKHJlcyk7XG4gIHJlcy5vbignY2xvc2UnLCAoKSA9PiB7XG4gICAgY2hhbm5lbHNbZGlzcF0uZGVsZXRlKHJlcyk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnJvYWRjYXN0KGRpc3A6IHN0cmluZykge1xuICBpZiAoIWNoYW5uZWxzW2Rpc3BdKSByZXR1cm47XG4gIGZvciAoY29uc3QgcmVzIG9mIGNoYW5uZWxzW2Rpc3BdKSB7XG4gICAgcmVzLndyaXRlKCdldmVudDogdXBkYXRlXFxuZGF0YTogMVxcblxcbicpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiY2hhbm5lbHMiLCJvcGVuQ2hhbm5lbCIsImRpc3AiLCJyZXMiLCJ3cml0ZUhlYWQiLCJDb25uZWN0aW9uIiwicmV0cnkiLCJTZXQiLCJhZGQiLCJvbiIsImRlbGV0ZSIsImJyb2FkY2FzdCIsIndyaXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/sse.ts\n");

/***/ }),

/***/ "(api)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXFEO0FBRTlDLE1BQU1DLFdBQVdELG1FQUFZQSxDQUNsQ0UsUUFBUUMsR0FBRyxDQUFDQyxZQUFZLEVBQ3hCRixRQUFRQyxHQUFHLENBQUNFLHlCQUF5QixFQUNyQyIsInNvdXJjZXMiOlsid2VicGFjazovL2ZseWNrLy4vbGliL3N1cGFiYXNlLnRzP2M5OWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcbiBcbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMISxcbiAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSFcbik7ICJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZSIsInByb2Nlc3MiLCJlbnYiLCJTVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/supabase.ts\n");

/***/ }),

/***/ "(api)/./pages/api/upload.ts":
/*!*****************************!*\
  !*** ./pages/api/upload.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_blob__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/blob */ \"(api)/./lib/blob.ts\");\n/* harmony import */ var _lib_kv__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/kv */ \"(api)/./lib/kv.ts\");\n/* harmony import */ var _lib_sse__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/sse */ \"(api)/./lib/sse.ts\");\n\n\n\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"POST\") return res.status(405).end();\n    const busboy = __webpack_require__(/*! busboy */ \"busboy\");\n    const bb = busboy({\n        headers: req.headers\n    });\n    const files = [];\n    const displays = [];\n    bb.on(\"file\", (_, file, info)=>{\n        const chunks = [];\n        let duration;\n        file.on(\"data\", (d)=>chunks.push(d));\n        file.on(\"end\", ()=>{\n            const buffer = Buffer.concat(chunks);\n            // Attach duration if available\n            const fileObj = new File([\n                buffer\n            ], info.filename, {\n                type: info.mimeType\n            });\n            fileObj.duration = duration;\n            files.push(fileObj);\n        });\n    });\n    bb.on(\"field\", (name, val)=>{\n        if (name === \"displays\") displays.push(val);\n        if (name.startsWith(\"duration:\")) {\n            // duration:<filename> = value\n            const filename = name.split(\":\")[1];\n            const file = files.find((f)=>f.name === filename);\n            if (file) file.duration = parseInt(val, 10);\n        }\n    });\n    bb.on(\"finish\", async ()=>{\n        for (const displayId of displays){\n            let slides = (await (0,_lib_kv__WEBPACK_IMPORTED_MODULE_1__.getSlides)(displayId)).map((s)=>({\n                    url: s.url,\n                    uploaded_at: s.uploadedAt,\n                    duration: s.duration ?? 10000\n                }));\n            for (const file of files){\n                try {\n                    console.log(\"Uploading\", file.name, file.size);\n                    const url = await (0,_lib_blob__WEBPACK_IMPORTED_MODULE_0__.uploadImage)(file);\n                    console.log(\"Uploaded\", url);\n                    slides.push({\n                        url,\n                        uploaded_at: new Date().toISOString(),\n                        duration: file.duration ?? 10000\n                    });\n                    if (slides.length > 50) slides = slides.slice(-50);\n                } catch (e) {\n                    console.error(\"Upload error:\", e);\n                }\n            }\n            await (0,_lib_kv__WEBPACK_IMPORTED_MODULE_1__.setSlides)(displayId, slides);\n            await (0,_lib_sse__WEBPACK_IMPORTED_MODULE_2__.broadcast)(displayId);\n        }\n        res.status(200).json({\n            ok: true\n        });\n    });\n    req.pipe(bb);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O0FBQ1giLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9mbHljay8uL3BhZ2VzL2FwaS91cGxvYWQudHM/NjBlOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgeyB1cGxvYWRJbWFnZSB9IGZyb20gJy4uLy4uL2xpYi9ibG9iJztcbmltcG9ydCB7IGdldFNsaWRlcywgc2V0U2xpZGVzIH0gZnJvbSAnLi4vLi4vbGliL2t2JztcbmltcG9ydCB7IGJyb2FkY2FzdCB9IGZyb20gJy4uLy4uL2xpYi9zc2UnO1xuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBhcGk6IHsgYm9keVBhcnNlcjogZmFsc2UgfSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXG4gIHJlczogTmV4dEFwaVJlc3BvbnNlXG4pIHtcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5lbmQoKTtcbiAgY29uc3QgYnVzYm95ID0gcmVxdWlyZSgnYnVzYm95Jyk7XG4gIGNvbnN0IGJiID0gYnVzYm95KHsgaGVhZGVyczogcmVxLmhlYWRlcnMgfSk7XG4gIGNvbnN0IGZpbGVzOiBGaWxlW10gPSBbXTtcbiAgY29uc3QgZGlzcGxheXM6IHN0cmluZ1tdID0gW107XG4gIGJiLm9uKCdmaWxlJywgKF8sIGZpbGUsIGluZm8pID0+IHtcbiAgICBjb25zdCBjaHVua3M6IEJ1ZmZlcltdID0gW107XG4gICAgbGV0IGR1cmF0aW9uOiBudW1iZXIgfCB1bmRlZmluZWQ7XG4gICAgZmlsZS5vbignZGF0YScsIChkOiBCdWZmZXIpID0+IGNodW5rcy5wdXNoKGQpKTtcbiAgICBmaWxlLm9uKCdlbmQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuY29uY2F0KGNodW5rcyk7XG4gICAgICAvLyBBdHRhY2ggZHVyYXRpb24gaWYgYXZhaWxhYmxlXG4gICAgICBjb25zdCBmaWxlT2JqID0gbmV3IEZpbGUoW2J1ZmZlcl0sIGluZm8uZmlsZW5hbWUsIHsgdHlwZTogaW5mby5taW1lVHlwZSB9KTtcbiAgICAgIChmaWxlT2JqIGFzIGFueSkuZHVyYXRpb24gPSBkdXJhdGlvbjtcbiAgICAgIGZpbGVzLnB1c2goZmlsZU9iaik7XG4gICAgfSk7XG4gIH0pO1xuICBiYi5vbignZmllbGQnLCAobmFtZSwgdmFsKSA9PiB7XG4gICAgaWYgKG5hbWUgPT09ICdkaXNwbGF5cycpIGRpc3BsYXlzLnB1c2godmFsKTtcbiAgICBpZiAobmFtZS5zdGFydHNXaXRoKCdkdXJhdGlvbjonKSkge1xuICAgICAgLy8gZHVyYXRpb246PGZpbGVuYW1lPiA9IHZhbHVlXG4gICAgICBjb25zdCBmaWxlbmFtZSA9IG5hbWUuc3BsaXQoJzonKVsxXTtcbiAgICAgIGNvbnN0IGZpbGUgPSBmaWxlcy5maW5kKGYgPT4gKGYgYXMgYW55KS5uYW1lID09PSBmaWxlbmFtZSk7XG4gICAgICBpZiAoZmlsZSkgKGZpbGUgYXMgYW55KS5kdXJhdGlvbiA9IHBhcnNlSW50KHZhbCwgMTApO1xuICAgIH1cbiAgfSk7XG4gIGJiLm9uKCdmaW5pc2gnLCBhc3luYyAoKSA9PiB7XG4gICAgZm9yIChjb25zdCBkaXNwbGF5SWQgb2YgZGlzcGxheXMpIHtcbiAgICAgIGxldCBzbGlkZXMgPSAoYXdhaXQgZ2V0U2xpZGVzKGRpc3BsYXlJZCkpLm1hcChzID0+ICh7IHVybDogcy51cmwsIHVwbG9hZGVkX2F0OiBzLnVwbG9hZGVkQXQsIGR1cmF0aW9uOiBzLmR1cmF0aW9uID8/IDEwMDAwIH0pKTtcbiAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdVcGxvYWRpbmcnLCBmaWxlLm5hbWUsIGZpbGUuc2l6ZSk7XG4gICAgICAgICAgY29uc3QgdXJsID0gYXdhaXQgdXBsb2FkSW1hZ2UoZmlsZSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1VwbG9hZGVkJywgdXJsKTtcbiAgICAgICAgICBzbGlkZXMucHVzaCh7IHVybCwgdXBsb2FkZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwgZHVyYXRpb246IChmaWxlIGFzIGFueSkuZHVyYXRpb24gPz8gMTAwMDAgfSk7XG4gICAgICAgICAgaWYgKHNsaWRlcy5sZW5ndGggPiA1MCkgc2xpZGVzID0gc2xpZGVzLnNsaWNlKC01MCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdVcGxvYWQgZXJyb3I6JywgZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGF3YWl0IHNldFNsaWRlcyhkaXNwbGF5SWQsIHNsaWRlcyk7XG4gICAgICBhd2FpdCBicm9hZGNhc3QoZGlzcGxheUlkKTtcbiAgICB9XG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBvazogdHJ1ZSB9KTtcbiAgfSk7XG4gIHJlcS5waXBlKGJiKTtcbn1cbiJdLCJuYW1lcyI6WyJ1cGxvYWRJbWFnZSIsImdldFNsaWRlcyIsInNldFNsaWRlcyIsImJyb2FkY2FzdCIsImNvbmZpZyIsImFwaSIsImJvZHlQYXJzZXIiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwiZW5kIiwiYnVzYm95IiwicmVxdWlyZSIsImJiIiwiaGVhZGVycyIsImZpbGVzIiwiZGlzcGxheXMiLCJvbiIsIl8iLCJmaWxlIiwiaW5mbyIsImNodW5rcyIsImR1cmF0aW9uIiwiZCIsInB1c2giLCJidWZmZXIiLCJCdWZmZXIiLCJjb25jYXQiLCJmaWxlT2JqIiwiRmlsZSIsImZpbGVuYW1lIiwidHlwZSIsIm1pbWVUeXBlIiwibmFtZSIsInZhbCIsInN0YXJ0c1dpdGgiLCJzcGxpdCIsImZpbmQiLCJmIiwicGFyc2VJbnQiLCJkaXNwbGF5SWQiLCJzbGlkZXMiLCJtYXAiLCJzIiwidXJsIiwidXBsb2FkZWRfYXQiLCJ1cGxvYWRlZEF0IiwiY29uc29sZSIsImxvZyIsInNpemUiLCJEYXRlIiwidG9JU09TdHJpbmciLCJsZW5ndGgiLCJzbGljZSIsImUiLCJlcnJvciIsImpzb24iLCJvayIsInBpcGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/upload.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fupload.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();